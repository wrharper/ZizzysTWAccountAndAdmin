<!DOCTYPE html>
<html>
<head>
    <title>TW404 Account Creation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #0b1220;
            color: #e6eef6;
        }
        .container {
            background: #071023;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.03);
        }
        h1 {
            color: #e6f7ff;
            text-align: center;
        }
        .status {
            text-align: center;
            padding: 10px;
            margin: 20px 0;
            border-radius: 4px;
            font-weight: bold;
            background: rgba(255,255,255,0.02);
            color: #cbd8e3;
        }
        .status.online {
            background: rgba(52,199,89,0.12);
            color: #7fffb3;
        }
        .status.offline {
            background: rgba(244,67,54,0.08);
            color: #ff9a8a;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        input {
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 4px;
            font-size: 14px;
            background: rgba(255,255,255,0.02);
            color: #e6eef6;
        }
        input::placeholder { color: rgba(230,238,246,0.5); }
        button {
            padding: 12px;
            background: linear-gradient(180deg,#1f9d7a,#0e8b63);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(14,139,99,0.25);
        }
        button:hover {
            filter: brightness(1.05);
        }
        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
            color: #071023;
        }
        .message.success {
            background: #7fffb3;
            display: block;
        }
        .message.error {
            background: #ff9a8a;
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>TW404 Account Creation</h1>
        <div id="status" class="status offline">Connecting to server...</div>
        
        <form id="accountForm">
            <input type="text" id="name" placeholder="Character Name (3+ chars)" required>
            <input type="password" id="password" placeholder="Password (6+ chars)" required>
            <input type="password" id="confirmPassword" placeholder="Confirm Password" required>
            <button type="submit">Create Account</button>
        </form>
        
        <div id="message" class="message"></div>
    </div>

    <script>
        function checkStatus() {
            fetch('/api/health')
                .then(r => r.json())
                .then(data => {
                    const status = document.getElementById('status');
                    if (data.solaris_connected) {
                        status.className = 'status online';
                        status.textContent = '✓ Server Connected';
                    } else {
                        status.className = 'status offline';
                        status.textContent = '✗ Server Offline';
                    }
                })
                .catch(() => {
                    document.getElementById('status').className = 'status offline';
                    document.getElementById('status').textContent = '✗ Cannot Connect';
                });
        }

        checkStatus();
        setInterval(checkStatus, 5000);

        document.getElementById('accountForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('name').value;
            const password = document.getElementById('password').value;
            const confirm = document.getElementById('confirmPassword').value;
            
            if (password !== confirm) {
                showMessage('Passwords do not match', 'error');
                return;
            }

            try {
                const res = await fetch('/api/create-account', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({name, password})
                });
                
                const data = await res.json();
                
                if (res.ok) {
                    showMessage('✓ ' + data.message, 'success');
                    document.getElementById('accountForm').reset();
                } else {
                    showMessage('✗ ' + data.error, 'error');
                }
            } catch (e) {
                showMessage('✗ Error: ' + e.message, 'error');
            }
        });

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message ' + type;
            setTimeout(() => msg.className = 'message', 5000);
        }
    </script>
</body>
</html>
